{"ast":null,"code":"import _toConsumableArray from\"/Users/alex/Documents/Build/test/flowerbi/client/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import React,{useRef}from\"react\";import{useQuery}from\"flowerbi-react\";import{FlowerBIChartBox}from\"flowerbi-react-utils\";import{Bug,Workflow}from\"../demoSchema\";import{dataColours}from\"./dataColours\";import{Pie}from\"react-chartjs-2\";import{jsx as _jsx}from\"react/jsx-runtime\";var id=\"SourceOfErrors\";export function SourceOfErrors(_ref){var pageFilters=_ref.pageFilters,fetch=_ref.fetch;var query={select:{sourceOfError:Workflow.SourceOfError,bugCount:Bug.Id.count()},filters:[Workflow.Resolved.equalTo(true)].concat(_toConsumableArray(pageFilters.getFilters(id))),comment:id};var result=useQuery(fetch,query);var ref=useRef(null);return/*#__PURE__*/_jsx(FlowerBIChartBox,{id:id,title:\"Source Of Errors\",state:result.state,children:/*#__PURE__*/_jsx(Pie,{ref:ref,options:{onClick:function onClick(evt,elements,chart){console.log(\"clicked\",{evt:evt,elements:elements,chart:chart});if(elements[0]){var clicked=result.records[elements[0].index].sourceOfError;pageFilters.setInteraction(id,[Workflow.SourceOfError.equalTo(clicked)]);}}},data:{labels:result.records.map(function(x){return x.sourceOfError;}),datasets:[{label:\"Count\",backgroundColor:dataColours,data:result.records.map(function(x){return x.bugCount;})}]}})});}","map":{"version":3,"sources":["/Users/alex/Documents/Build/test/flowerbi/client/packages/demo-site/src/Reports/SourceOfErrors.tsx"],"names":["React","useRef","useQuery","FlowerBIChartBox","Bug","Workflow","dataColours","Pie","id","SourceOfErrors","pageFilters","fetch","query","select","sourceOfError","SourceOfError","bugCount","Id","count","filters","Resolved","equalTo","getFilters","comment","result","ref","state","onClick","evt","elements","chart","console","log","clicked","records","index","setInteraction","labels","map","x","datasets","label","backgroundColor","data"],"mappings":"8IAAA,MAAOA,CAAAA,KAAP,EAAgBC,MAAhB,KAA8B,OAA9B,CACA,OAASC,QAAT,KAAyB,gBAAzB,CACA,OAASC,gBAAT,KAAiC,sBAAjC,CACA,OAASC,GAAT,CAAcC,QAAd,KAA8B,eAA9B,CACA,OAASC,WAAT,KAA4B,eAA5B,CACA,OAASC,GAAT,KAAoB,iBAApB,C,2CAIA,GAAMC,CAAAA,EAAE,CAAG,gBAAX,CAEA,MAAO,SAASC,CAAAA,cAAT,MAA6D,IAAnCC,CAAAA,WAAmC,MAAnCA,WAAmC,CAAtBC,KAAsB,MAAtBA,KAAsB,CAEhE,GAAMC,CAAAA,KAAK,CAAG,CACVC,MAAM,CAAE,CACJC,aAAa,CAAET,QAAQ,CAACU,aADpB,CAEJC,QAAQ,CAAEZ,GAAG,CAACa,EAAJ,CAAOC,KAAP,EAFN,CADE,CAKVC,OAAO,EACHd,QAAQ,CAACe,QAAT,CAAkBC,OAAlB,CAA0B,IAA1B,CADG,4BAEAX,WAAW,CAACY,UAAZ,CAAuBd,EAAvB,CAFA,EALG,CASVe,OAAO,CAAEf,EATC,CAAd,CAYA,GAAMgB,CAAAA,MAAM,CAAGtB,QAAQ,CAACS,KAAD,CAAQC,KAAR,CAAvB,CAEA,GAAMa,CAAAA,GAAG,CAAGxB,MAAM,CAAiB,IAAjB,CAAlB,CAEA,mBACI,KAAC,gBAAD,EAAkB,EAAE,CAAEO,EAAtB,CAA0B,KAAK,CAAC,kBAAhC,CAAmD,KAAK,CAAEgB,MAAM,CAACE,KAAjE,uBACI,KAAC,GAAD,EACI,GAAG,CAAED,GADT,CAEI,OAAO,CAAE,CACLE,OADK,kBACGC,GADH,CACQC,QADR,CACkBC,KADlB,CACyB,CAC1BC,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuB,CAAEJ,GAAG,CAAHA,GAAF,CAAOC,QAAQ,CAARA,QAAP,CAAiBC,KAAK,CAALA,KAAjB,CAAvB,EACA,GAAID,QAAQ,CAAC,CAAD,CAAZ,CAAiB,CACb,GAAMI,CAAAA,OAAO,CAAGT,MAAM,CAACU,OAAP,CAAeL,QAAQ,CAAC,CAAD,CAAR,CAAYM,KAA3B,EAAkCrB,aAAlD,CACAJ,WAAW,CAAC0B,cAAZ,CAA2B5B,EAA3B,CAA+B,CAC3BH,QAAQ,CAACU,aAAT,CAAuBM,OAAvB,CAA+BY,OAA/B,CAD2B,CAA/B,EAGH,CACJ,CATI,CAFb,CAaI,IAAI,CAAE,CACFI,MAAM,CAAEb,MAAM,CAACU,OAAP,CAAeI,GAAf,CAAmB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACzB,aAAN,EAApB,CADN,CAEF0B,QAAQ,CAAE,CAAC,CACPC,KAAK,CAAE,OADA,CAEPC,eAAe,CAAEpC,WAFV,CAGPqC,IAAI,CAAEnB,MAAM,CAACU,OAAP,CAAeI,GAAf,CAAmB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAACvB,QAAN,EAApB,CAHC,CAAD,CAFR,CAbV,EADJ,EADJ,CA0BH","sourcesContent":["import React, { useRef } from \"react\";\nimport { useQuery } from \"flowerbi-react\";\nimport { FlowerBIChartBox } from \"flowerbi-react-utils\";\nimport { Bug, Workflow } from \"../demoSchema\";\nimport { dataColours } from \"./dataColours\";\nimport { Pie } from \"react-chartjs-2\";\nimport { Chart as ChartJS } from \"chart.js\";\nimport { VisualProps } from \"./VisualProps\";\n\nconst id = \"SourceOfErrors\";\n\nexport function SourceOfErrors({ pageFilters, fetch }: VisualProps) {\n\n    const query = {\n        select: {\n            sourceOfError: Workflow.SourceOfError,\n            bugCount: Bug.Id.count()\n        },\n        filters: [\n            Workflow.Resolved.equalTo(true),\n            ...pageFilters.getFilters(id)\n        ],\n        comment: id\n    };\n\n    const result = useQuery(fetch, query);\n\n    const ref = useRef<ChartJS<\"pie\">>(null);\n    \n    return (\n        <FlowerBIChartBox id={id} title=\"Source Of Errors\" state={result.state}>\n            <Pie\n                ref={ref}\n                options={{\n                    onClick(evt, elements, chart) {\n                        console.log(\"clicked\", { evt, elements, chart });\n                        if (elements[0]) {\n                            const clicked = result.records[elements[0].index].sourceOfError;\n                            pageFilters.setInteraction(id, [\n                                Workflow.SourceOfError.equalTo(clicked)\n                            ]);\n                        }\n                    }\n                }} \n                data={{\n                    labels: result.records.map(x => x.sourceOfError),\n                    datasets: [{\n                        label: \"Count\",\n                        backgroundColor: dataColours,\n                        data: result.records.map(x => x.bugCount)\n                    }]\n                }}\n            />\n        </FlowerBIChartBox>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}