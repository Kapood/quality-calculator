{"ast":null,"code":"var _jsxFileName = \"/Users/alex/Documents/Build/test/flowerbi/client/packages/demo-site/src/Reports/SourceOfErrors.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useRef } from \"react\";\nimport { useQuery } from \"flowerbi-react\";\nimport { FlowerBIChartBox } from \"flowerbi-react-utils\";\nimport { Bug, Workflow } from \"../demoSchema\";\nimport { dataColours } from \"./dataColours\";\nimport { Pie } from \"react-chartjs-2\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst id = \"SourceOfErrors\";\nexport function SourceOfErrors(_ref) {\n  _s();\n\n  let {\n    pageFilters,\n    fetch\n  } = _ref;\n  const query = {\n    select: {\n      sourceOfError: Workflow.SourceOfError,\n      bugCount: Bug.Id.count()\n    },\n    filters: [Workflow.Resolved.equalTo(true), ...pageFilters.getFilters(id)],\n    comment: id\n  };\n  const result = useQuery(fetch, query);\n  const ref = useRef(null);\n  return /*#__PURE__*/_jsxDEV(FlowerBIChartBox, {\n    id: id,\n    title: \"Test Quality Metrics\",\n    state: result.state,\n    children: /*#__PURE__*/_jsxDEV(Pie, {\n      ref: ref,\n      options: {\n        onClick(evt, elements, chart) {\n          console.log(\"clicked\", {\n            evt,\n            elements,\n            chart\n          });\n\n          if (elements[0]) {\n            const clicked = result.records[elements[0].index].sourceOfError;\n            pageFilters.setInteraction(id, [Workflow.SourceOfError.equalTo(clicked)]);\n          }\n        }\n\n      },\n      data: {\n        labels: result.records.map(x => x.sourceOfError),\n        datasets: [{\n          label: \"Count\",\n          backgroundColor: dataColours,\n          data: result.records.map(x => x.bugCount)\n        }]\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 31,\n    columnNumber: 9\n  }, this);\n}\n\n_s(SourceOfErrors, \"MZ32kQvTkn1aYTEBuok+EszVoiI=\", false, function () {\n  return [useQuery];\n});\n\n_c = SourceOfErrors;\n\nvar _c;\n\n$RefreshReg$(_c, \"SourceOfErrors\");","map":{"version":3,"sources":["/Users/alex/Documents/Build/test/flowerbi/client/packages/demo-site/src/Reports/SourceOfErrors.tsx"],"names":["React","useRef","useQuery","FlowerBIChartBox","Bug","Workflow","dataColours","Pie","id","SourceOfErrors","pageFilters","fetch","query","select","sourceOfError","SourceOfError","bugCount","Id","count","filters","Resolved","equalTo","getFilters","comment","result","ref","state","onClick","evt","elements","chart","console","log","clicked","records","index","setInteraction","labels","map","x","datasets","label","backgroundColor","data"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,MAAhB,QAA8B,OAA9B;AACA,SAASC,QAAT,QAAyB,gBAAzB;AACA,SAASC,gBAAT,QAAiC,sBAAjC;AACA,SAASC,GAAT,EAAcC,QAAd,QAA8B,eAA9B;AACA,SAASC,WAAT,QAA4B,eAA5B;AACA,SAASC,GAAT,QAAoB,iBAApB;;AAIA,MAAMC,EAAE,GAAG,gBAAX;AAEA,OAAO,SAASC,cAAT,OAA6D;AAAA;;AAAA,MAArC;AAAEC,IAAAA,WAAF;AAAeC,IAAAA;AAAf,GAAqC;AAEhE,QAAMC,KAAK,GAAG;AACVC,IAAAA,MAAM,EAAE;AACJC,MAAAA,aAAa,EAAET,QAAQ,CAACU,aADpB;AAEJC,MAAAA,QAAQ,EAAEZ,GAAG,CAACa,EAAJ,CAAOC,KAAP;AAFN,KADE;AAKVC,IAAAA,OAAO,EAAE,CACLd,QAAQ,CAACe,QAAT,CAAkBC,OAAlB,CAA0B,IAA1B,CADK,EAEL,GAAGX,WAAW,CAACY,UAAZ,CAAuBd,EAAvB,CAFE,CALC;AASVe,IAAAA,OAAO,EAAEf;AATC,GAAd;AAYA,QAAMgB,MAAM,GAAGtB,QAAQ,CAACS,KAAD,EAAQC,KAAR,CAAvB;AAEA,QAAMa,GAAG,GAAGxB,MAAM,CAAiB,IAAjB,CAAlB;AAEA,sBACI,QAAC,gBAAD;AAAkB,IAAA,EAAE,EAAEO,EAAtB;AAA0B,IAAA,KAAK,EAAC,sBAAhC;AAAuD,IAAA,KAAK,EAAEgB,MAAM,CAACE,KAArE;AAAA,2BACI,QAAC,GAAD;AACI,MAAA,GAAG,EAAED,GADT;AAEI,MAAA,OAAO,EAAE;AACLE,QAAAA,OAAO,CAACC,GAAD,EAAMC,QAAN,EAAgBC,KAAhB,EAAuB;AAC1BC,UAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ,EAAuB;AAAEJ,YAAAA,GAAF;AAAOC,YAAAA,QAAP;AAAiBC,YAAAA;AAAjB,WAAvB;;AACA,cAAID,QAAQ,CAAC,CAAD,CAAZ,EAAiB;AACb,kBAAMI,OAAO,GAAGT,MAAM,CAACU,OAAP,CAAeL,QAAQ,CAAC,CAAD,CAAR,CAAYM,KAA3B,EAAkCrB,aAAlD;AACAJ,YAAAA,WAAW,CAAC0B,cAAZ,CAA2B5B,EAA3B,EAA+B,CAC3BH,QAAQ,CAACU,aAAT,CAAuBM,OAAvB,CAA+BY,OAA/B,CAD2B,CAA/B;AAGH;AACJ;;AATI,OAFb;AAaI,MAAA,IAAI,EAAE;AACFI,QAAAA,MAAM,EAAEb,MAAM,CAACU,OAAP,CAAeI,GAAf,CAAmBC,CAAC,IAAIA,CAAC,CAACzB,aAA1B,CADN;AAEF0B,QAAAA,QAAQ,EAAE,CAAC;AACPC,UAAAA,KAAK,EAAE,OADA;AAEPC,UAAAA,eAAe,EAAEpC,WAFV;AAGPqC,UAAAA,IAAI,EAAEnB,MAAM,CAACU,OAAP,CAAeI,GAAf,CAAmBC,CAAC,IAAIA,CAAC,CAACvB,QAA1B;AAHC,SAAD;AAFR;AAbV;AAAA;AAAA;AAAA;AAAA;AADJ;AAAA;AAAA;AAAA;AAAA,UADJ;AA0BH;;GA5CeP,c;UAcGP,Q;;;KAdHO,c","sourcesContent":["import React, { useRef } from \"react\";\nimport { useQuery } from \"flowerbi-react\";\nimport { FlowerBIChartBox } from \"flowerbi-react-utils\";\nimport { Bug, Workflow } from \"../demoSchema\";\nimport { dataColours } from \"./dataColours\";\nimport { Pie } from \"react-chartjs-2\";\nimport { Chart as ChartJS } from \"chart.js\";\nimport { VisualProps } from \"./VisualProps\";\n\nconst id = \"SourceOfErrors\";\n\nexport function SourceOfErrors({ pageFilters, fetch }: VisualProps) {\n\n    const query = {\n        select: {\n            sourceOfError: Workflow.SourceOfError,\n            bugCount: Bug.Id.count()\n        },\n        filters: [\n            Workflow.Resolved.equalTo(true),\n            ...pageFilters.getFilters(id)\n        ],\n        comment: id\n    };\n\n    const result = useQuery(fetch, query);\n\n    const ref = useRef<ChartJS<\"pie\">>(null);\n    \n    return (\n        <FlowerBIChartBox id={id} title=\"Test Quality Metrics\" state={result.state}>\n            <Pie\n                ref={ref}\n                options={{\n                    onClick(evt, elements, chart) {\n                        console.log(\"clicked\", { evt, elements, chart });\n                        if (elements[0]) {\n                            const clicked = result.records[elements[0].index].sourceOfError;\n                            pageFilters.setInteraction(id, [\n                                Workflow.SourceOfError.equalTo(clicked)\n                            ]);\n                        }\n                    }\n                }} \n                data={{\n                    labels: result.records.map(x => x.sourceOfError),\n                    datasets: [{\n                        label: \"Count\",\n                        backgroundColor: dataColours,\n                        data: result.records.map(x => x.bugCount)\n                    }]\n                }}\n            />\n        </FlowerBIChartBox>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}