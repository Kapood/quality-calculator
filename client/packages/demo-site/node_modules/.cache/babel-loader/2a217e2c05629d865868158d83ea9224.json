{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.usePageFilters = void 0;\n\nvar react_1 = require(\"react\");\n\nvar json_stable_stringify_1 = __importDefault(require(\"json-stable-stringify\"));\n\nvar clearedState = {\n  global: [],\n  interactions: [],\n  interactionKey: \"\"\n};\n\nfunction usePageFilters() {\n  var _a = (0, react_1.useState)(clearedState),\n      state = _a[0],\n      set = _a[1];\n\n  function setInteraction(interactionKey, interactions) {\n    console.log(interactionKey, state.interactionKey, state.interactionKey === interactionKey, interactions, state.interactions, (0, json_stable_stringify_1.default)(state.interactions), (0, json_stable_stringify_1.default)(interactions), (0, json_stable_stringify_1.default)(state.interactions) === (0, json_stable_stringify_1.default)(interactions));\n\n    if (state.interactionKey === interactionKey && (0, json_stable_stringify_1.default)(state.interactions) === (0, json_stable_stringify_1.default)(interactions)) {\n      clearInteraction();\n    } else {\n      set(__assign(__assign({}, state), {\n        interactionKey: interactionKey,\n        interactions: interactions\n      }));\n    }\n  }\n\n  function setGlobal(global) {\n    set(__assign(__assign({}, state), {\n      global: global\n    }));\n  }\n\n  function clearInteraction() {\n    set(__assign(__assign({}, state), {\n      interactionKey: \"\",\n      interactions: []\n    }));\n  }\n\n  function clearGlobal() {\n    set(__assign(__assign({}, state), {\n      global: []\n    }));\n  }\n\n  function clearAll() {\n    set(clearedState);\n  }\n\n  function getFilters(key) {\n    var result = state.global;\n    return key !== state.interactionKey ? result.concat(state.interactions) : result;\n  }\n\n  return __assign(__assign({}, state), {\n    setInteraction: setInteraction,\n    setGlobal: setGlobal,\n    clearInteraction: clearInteraction,\n    clearGlobal: clearGlobal,\n    clearAll: clearAll,\n    getFilters: getFilters\n  });\n}\n\nexports.usePageFilters = usePageFilters;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA;;AAiBA,IAAMA,YAAY,GAAqB;AACnCC,QAAM,EAAE,EAD2B;AAEnCC,cAAY,EAAE,EAFqB;AAGnCC,gBAAc,EAAE;AAHmB,CAAvC;;AAMA,SAAgBC,cAAhB,GAA8B;AACpB,WAAe,sBAA2BJ,YAA3B,CAAf;AAAA,MAACK,KAAK,QAAN;AAAA,MAAQC,GAAG,QAAX;;AACN,WAASC,cAAT,CAAwBJ,cAAxB,EAAgDD,YAAhD,EAA0E;AACtEM,WAAO,CAACC,GAAR,CAAYN,cAAZ,EAA4BE,KAAK,CAACF,cAAlC,EAAkDE,KAAK,CAACF,cAAN,KAAyBA,cAA3E,EACID,YADJ,EACkBG,KAAK,CAACH,YADxB,EAEI,qCAAgBG,KAAK,CAACH,YAAtB,CAFJ,EAEyC,qCAAgBA,YAAhB,CAFzC,EAGI,qCAAgBG,KAAK,CAACH,YAAtB,MAAwC,qCAAgBA,YAAhB,CAH5C;;AAKA,QAAIG,KAAK,CAACF,cAAN,KAAyBA,cAAzB,IACA,qCAAgBE,KAAK,CAACH,YAAtB,MAAwC,qCAAgBA,YAAhB,CAD5C,EAC2E;AACvEQ,sBAAgB;AACnB,KAHD,MAGO;AACHJ,SAAG,uBAAMD,KAAN,GAAW;AAAEF,sBAAc,gBAAhB;AAAkBD,oBAAY;AAA9B,OAAX,EAAH;AACH;AACJ;;AACD,WAASS,SAAT,CAAmBV,MAAnB,EAAuC;AACnCK,OAAG,uBAAMD,KAAN,GAAW;AAAEJ,YAAM;AAAR,KAAX,EAAH;AACH;;AACD,WAASS,gBAAT,GAAyB;AACrBJ,OAAG,uBAAMD,KAAN,GAAW;AAAEF,oBAAc,EAAE,EAAlB;AAAsBD,kBAAY,EAAE;AAApC,KAAX,EAAH;AACH;;AACD,WAASU,WAAT,GAAoB;AAChBN,OAAG,uBAAMD,KAAN,GAAW;AAAEJ,YAAM,EAAE;AAAV,KAAX,EAAH;AACH;;AACD,WAASY,QAAT,GAAiB;AACbP,OAAG,CAACN,YAAD,CAAH;AACH;;AACD,WAASc,UAAT,CAAoBC,GAApB,EAA+B;AAC3B,QAAMC,MAAM,GAAGX,KAAK,CAACJ,MAArB;AACA,WAAOc,GAAG,KAAKV,KAAK,CAACF,cAAd,GAA+Ba,MAAM,CAACC,MAAP,CAAcZ,KAAK,CAACH,YAApB,CAA/B,GAAmEc,MAA1E;AACH;;AACD,+BAAYX,KAAZ,GAAiB;AAAEE,kBAAc,gBAAhB;AAAkBI,aAAS,WAA3B;AAA6BD,oBAAgB,kBAA7C;AAA+CE,eAAW,aAA1D;AAA4DC,YAAQ,UAApE;AAAsEC,cAAU;AAAhF,GAAjB;AACH;;AAhCDI","names":["clearedState","global","interactions","interactionKey","usePageFilters","state","set","setInteraction","console","log","clearInteraction","setGlobal","clearGlobal","clearAll","getFilters","key","result","concat","exports"],"sources":["/Users/alex/Documents/Build/test/flowerbi/client/packages/flowerbi-react/src/usePageFilters.ts"],"sourcesContent":["import { useState } from \"react\";\nimport { FilterJson } from \"flowerbi\";\nimport stableStringify from \"json-stable-stringify\";\n\nexport interface PageFiltersState {\n    readonly global: FilterJson[];\n    readonly interactions: FilterJson[];\n    readonly interactionKey: string;\n}\n\nexport interface PageFilters extends PageFiltersState {\n    setInteraction(key: string, filters: FilterJson[]): void;\n    setGlobal(filters: FilterJson[]): void;\n    clearInteraction(): void;\n    clearGlobal(): void;\n    clearAll(): void;\n    getFilters(key: string): FilterJson[];\n}\n\nconst clearedState: PageFiltersState = {\n    global: [],\n    interactions: [],\n    interactionKey: \"\",\n};\n\nexport function usePageFilters(): PageFilters {\n    const [state, set] = useState<PageFiltersState>(clearedState);\n    function setInteraction(interactionKey: string, interactions: FilterJson[]) {\n        console.log(interactionKey, state.interactionKey, state.interactionKey === interactionKey,\n            interactions, state.interactions,\n            stableStringify(state.interactions), stableStringify(interactions),\n            stableStringify(state.interactions) === stableStringify(interactions));\n\n        if (state.interactionKey === interactionKey &&\n            stableStringify(state.interactions) === stableStringify(interactions)) {\n            clearInteraction();\n        } else {\n            set({ ...state, interactionKey, interactions });\n        }\n    }\n    function setGlobal(global: FilterJson[]) {\n        set({ ...state, global });\n    }\n    function clearInteraction() {\n        set({ ...state, interactionKey: \"\", interactions: [] });\n    }\n    function clearGlobal() {\n        set({ ...state, global: [] });\n    }\n    function clearAll() {\n        set(clearedState);\n    }\n    function getFilters(key: string) {\n        const result = state.global;\n        return key !== state.interactionKey ? result.concat(state.interactions) : result;\n    }\n    return { ...state, setInteraction, setGlobal, clearInteraction, clearGlobal, clearAll, getFilters };\n}\n\nexport interface PageFiltersProp {\n    pageFilters: PageFilters;\n}\n"]},"metadata":{},"sourceType":"script"}